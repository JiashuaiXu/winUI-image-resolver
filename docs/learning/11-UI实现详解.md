# 11. UI å®ç°è¯¦è§£

è¯¦ç»†è§£æä¸»çª—å£ UI çš„å®ç°æ–¹å¼ã€‚

## ğŸ—ï¸ æ•´ä½“å¸ƒå±€

### ä¸‰è¡Œå¸ƒå±€ç»“æ„

```xml
<Grid>
    <Grid.RowDefinitions>
        <RowDefinition Height="Auto"/>  <!-- Header: è‡ªåŠ¨é«˜åº¦ -->
        <RowDefinition Height="*"/>     <!-- Content: å¡«å……å‰©ä½™ç©ºé—´ -->
        <RowDefinition Height="Auto"/>  <!-- Footer: è‡ªåŠ¨é«˜åº¦ -->
    </Grid.RowDefinitions>
</Grid>
```

**è¯´æ˜**:
- `Height="Auto"`: æ ¹æ®å†…å®¹è‡ªåŠ¨è°ƒæ•´
- `Height="*"`: å¡«å……å‰©ä½™ç©ºé—´
- å½¢æˆ Header-Content-Footer å¸ƒå±€

## ğŸ“‹ Header åŒºåŸŸ

### å¸ƒå±€ç»“æ„

```xml
<Border Grid.Row="0" Background="{ThemeResource SystemControlAcrylicWindowBrush}">
    <Grid Margin="24,16">
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="*"/>
            <ColumnDefinition Width="Auto"/>
        </Grid.ColumnDefinitions>
        
        <!-- å·¦ä¾§ï¼šæ ‡é¢˜å’Œæè¿° -->
        <StackPanel Grid.Column="0">
            <TextBlock Text="Image Resolver" 
                       Style="{ThemeResource TitleTextBlockStyle}" 
                       FontSize="32"/>
            <TextBlock Text="Extract resolution and EXIF metadata" 
                       Style="{ThemeResource BodyTextBlockStyle}"/>
        </StackPanel>
        
        <!-- å³ä¾§ï¼šæŒ‰é’® -->
        <Button Grid.Column="1"
                x:Name="SelectFolderButton"
                Content="Select Folder"
                Click="SelectFolderButton_Click"/>
    </Grid>
</Border>
```

**ç‰¹ç‚¹**:
- ä½¿ç”¨ Acrylic èƒŒæ™¯ï¼ˆæ¯›ç»ç’ƒæ•ˆæœï¼‰
- å·¦å³åˆ†æ å¸ƒå±€
- å“åº”å¼è®¾è®¡

## ğŸ–¼ï¸ Content åŒºåŸŸ

### ä¸‰æ å¸ƒå±€

```xml
<Grid Grid.Row="1" Margin="24">
    <Grid.ColumnDefinitions>
        <ColumnDefinition Width="2*"/>  <!-- å›¾ç‰‡åˆ—è¡¨ï¼šå  40% -->
        <ColumnDefinition Width="8"/>   <!-- åˆ†éš”çº¿ï¼š8px -->
        <ColumnDefinition Width="3*"/>   <!-- è¯¦æƒ…é¢æ¿ï¼šå  60% -->
    </Grid.ColumnDefinitions>
    
    <!-- å·¦ä¾§ï¼šå›¾ç‰‡åˆ—è¡¨ -->
    <Grid Grid.Column="0">
        <TextBlock Text="Images" Style="{ThemeResource SubtitleTextBlockStyle}"/>
        <ScrollViewer>
            <ItemsControl x:Name="ImageListControl">
                <!-- æ•°æ®æ¨¡æ¿ -->
            </ItemsControl>
        </ScrollViewer>
    </Grid>
    
    <!-- ä¸­é—´ï¼šåˆ†éš”çº¿ -->
    <Rectangle Grid.Column="1" 
               Fill="{ThemeResource SystemControlForegroundBaseLowBrush}"/>
    
    <!-- å³ä¾§ï¼šè¯¦æƒ…é¢æ¿ -->
    <Grid Grid.Column="2">
        <TextBlock Text="Details" Style="{ThemeResource SubtitleTextBlockStyle}"/>
        <ScrollViewer>
            <StackPanel x:Name="DetailsPanel"/>
        </ScrollViewer>
    </Grid>
</Grid>
```

**è¯´æ˜**:
- `Width="2*"` å’Œ `Width="3*"`: æ¯”ä¾‹å¸ƒå±€ï¼ˆ2:3ï¼‰
- ä½¿ç”¨ `ScrollViewer` æ”¯æŒæ»šåŠ¨
- `ItemsControl` ç”¨äºæ˜¾ç¤ºåˆ—è¡¨

## ğŸ“ å›¾ç‰‡åˆ—è¡¨é¡¹æ¨¡æ¿

### DataTemplate

```xml
<ItemsControl.ItemTemplate>
    <DataTemplate>
        <Border Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                BorderThickness="1"
                CornerRadius="8"
                Padding="16"
                Margin="0,0,0,12"
                PointerPressed="ImageItem_PointerPressed">
            <Grid>
                <!-- ç¼©ç•¥å›¾ -->
                <Border Width="80" Height="80">
                    <Image Source="{Binding Thumbnail}"/>
                </Border>
                
                <!-- ä¿¡æ¯ -->
                <StackPanel>
                    <TextBlock Text="{Binding FileName}" FontWeight="SemiBold"/>
                    <TextBlock Text="{Binding Resolution}"/>
                    <TextBlock Text="{Binding FileSizeFormatted}"/>
                </StackPanel>
            </Grid>
        </Border>
    </DataTemplate>
</ItemsControl.ItemTemplate>
```

**è¯´æ˜**:
- `DataTemplate`: å®šä¹‰åˆ—è¡¨é¡¹çš„å¤–è§‚
- `{Binding ...}`: æ•°æ®ç»‘å®š
- `PointerPressed`: ç‚¹å‡»äº‹ä»¶

## ğŸ¨ è¯¦æƒ…é¢æ¿åŠ¨æ€ç”Ÿæˆ

### ä»£ç å®ç°

```csharp
private void UpdateDetailsPanel(ImageInfoViewModel viewModel)
{
    DetailsPanel.Children.Clear();
    
    var info = viewModel.ImageInfo;
    
    // åŸºæœ¬ä¿¡æ¯å¡ç‰‡
    AddDetailCard("Basic Information", new Dictionary<string, string>
    {
        { "File Name", info.FileName },
        { "Resolution", info.Resolution },
        { "File Size", info.FileSizeFormatted }
    });
    
    // ç›¸æœºä¿¡æ¯å¡ç‰‡ï¼ˆå¦‚æœæœ‰ï¼‰
    if (!string.IsNullOrEmpty(info.CameraMake))
    {
        AddDetailCard("Camera Information", new Dictionary<string, string>
        {
            { "Make", info.CameraMake },
            { "Model", info.CameraModel ?? "N/A" }
        });
    }
}
```

**è¯´æ˜**:
- åŠ¨æ€åˆ›å»º UI å…ƒç´ 
- æ ¹æ®æ•°æ®å†³å®šæ˜¾ç¤ºå†…å®¹
- ä½¿ç”¨å¡ç‰‡å¼å¸ƒå±€

## ğŸ¯ äº‹ä»¶å¤„ç†

### æ–‡ä»¶å¤¹é€‰æ‹©

```csharp
private async void SelectFolderButton_Click(object sender, RoutedEventArgs e)
{
    var folderPicker = new FolderPicker();
    folderPicker.FileTypeFilter.Add("*");
    
    // åˆå§‹åŒ–çª—å£å¥æŸ„ï¼ˆWinUI 3 è¦æ±‚ï¼‰
    var hwnd = WinRT.Interop.WindowNative.GetWindowHandle(this);
    WinRT.Interop.InitializeWithWindow.Initialize(folderPicker, hwnd);
    
    var folder = await folderPicker.PickSingleFolderAsync();
    if (folder != null)
    {
        await LoadImagesAsync(folder.Path);
    }
}
```

### å›¾ç‰‡é€‰æ‹©ä¸è§†è§‰åé¦ˆ

```csharp
private Border? _previousSelectedBorder;

private void ImageItem_PointerPressed(object sender, PointerRoutedEventArgs e)
{
    if (sender is Border border && border.DataContext is ImageInfoViewModel viewModel)
    {
        // æ¢å¤ä¹‹å‰é€‰ä¸­é¡¹çš„æ ·å¼
        if (_previousSelectedBorder != null && _previousSelectedBorder != border)
        {
            ResetBorderStyle(_previousSelectedBorder);
        }
        
        // æ¸…é™¤ä¹‹å‰é€‰ä¸­é¡¹çš„çŠ¶æ€
        if (_selectedImage != null && _selectedImage != viewModel)
        {
            _selectedImage.IsSelected = false;
        }
        
        // è®¾ç½®æ–°çš„é€‰ä¸­é¡¹
        _selectedImage = viewModel;
        viewModel.IsSelected = true;
        _previousSelectedBorder = border;
        
        // æ›´æ–°å½“å‰é¡¹çš„æ ·å¼ä¸ºé€‰ä¸­çŠ¶æ€
        ApplySelectedStyle(border);
        
        UpdateDetailsPanel(viewModel);
    }
}
```

**è¯´æ˜**:
- ç‚¹å‡»å›¾ç‰‡é¡¹æ—¶ï¼Œä¼šæ¸…é™¤ä¹‹å‰é€‰ä¸­é¡¹çš„æ ·å¼
- æ–°é€‰ä¸­é¡¹ä¼šåº”ç”¨é«˜äº®æ ·å¼ï¼ˆèƒŒæ™¯è‰²å’Œè¾¹æ¡†å˜åŒ–ï¼‰
- åŒæ—¶æ›´æ–°å³ä¾§è¯¦æƒ…é¢æ¿

## ğŸ¨ é€‰ä¸­çŠ¶æ€è§†è§‰åé¦ˆ

### å®ç°åŸç†

å½“ç”¨æˆ·ç‚¹å‡»å›¾ç‰‡é¡¹æ—¶ï¼Œéœ€è¦æä¾›æ¸…æ™°çš„è§†è§‰åé¦ˆï¼Œè®©ç”¨æˆ·çŸ¥é“å“ªå¼ å›¾ç‰‡è¢«é€‰ä¸­äº†ã€‚

### ViewModel ä¸­çš„é€‰ä¸­çŠ¶æ€

```csharp
public class ImageInfoViewModel : INotifyPropertyChanged
{
    private bool _isSelected;
    
    public bool IsSelected
    {
        get => _isSelected;
        set
        {
            if (_isSelected != value)
            {
                _isSelected = value;
                OnPropertyChanged(nameof(IsSelected));
            }
        }
    }
}
```

### æ ·å¼åˆ‡æ¢æ–¹æ³•

```csharp
// åº”ç”¨é€‰ä¸­æ ·å¼
private void ApplySelectedStyle(Border border)
{
    // ä½¿ç”¨ç³»ç»Ÿé«˜äº®è‰²ï¼Œè‡ªåŠ¨é€‚é…æ·±è‰²/æµ…è‰²ä¸»é¢˜
    var accentBrush = (Microsoft.UI.Xaml.Media.Brush)Application.Current.Resources["SystemControlHighlightAccentBrush"];
    var accentLowBrush = (Microsoft.UI.Xaml.Media.Brush)Application.Current.Resources["SystemControlHighlightListAccentLowBrush"];
    
    border.Background = accentLowBrush ?? new Microsoft.UI.Xaml.Media.SolidColorBrush(
        Microsoft.UI.ColorHelper.FromArgb(255, 0, 120, 215));
    border.BorderBrush = accentBrush ?? new Microsoft.UI.Xaml.Media.SolidColorBrush(
        Microsoft.UI.ColorHelper.FromArgb(255, 0, 99, 177));
    border.BorderThickness = new Thickness(2);
}

// æ¢å¤é»˜è®¤æ ·å¼
private void ResetBorderStyle(Border border)
{
    border.Background = (Microsoft.UI.Xaml.Media.Brush)Application.Current.Resources["CardBackgroundFillColorDefaultBrush"];
    border.BorderBrush = (Microsoft.UI.Xaml.Media.Brush)Application.Current.Resources["CardStrokeColorDefaultBrush"];
    border.BorderThickness = new Thickness(1);
}
```

### è§†è§‰æ•ˆæœ

**é€‰ä¸­çŠ¶æ€**:
- èƒŒæ™¯è‰²ï¼šç³»ç»Ÿé«˜äº®æµ…è‰²ï¼ˆSystemControlHighlightListAccentLowBrushï¼‰
- è¾¹æ¡†ï¼šç³»ç»Ÿ Accent è‰²ï¼ˆSystemControlHighlightAccentBrushï¼‰
- è¾¹æ¡†å®½åº¦ï¼š2px

**æœªé€‰ä¸­çŠ¶æ€**:
- èƒŒæ™¯è‰²ï¼šé»˜è®¤å¡ç‰‡èƒŒæ™¯è‰²
- è¾¹æ¡†ï¼šé»˜è®¤å¡ç‰‡è¾¹æ¡†è‰²
- è¾¹æ¡†å®½åº¦ï¼š1px

**ä¼˜åŠ¿**:
- âœ… æ¸…æ™°çš„è§†è§‰åé¦ˆ
- âœ… è‡ªåŠ¨é€‚é…æ·±è‰²/æµ…è‰²ä¸»é¢˜
- âœ… ä½¿ç”¨ç³»ç»Ÿä¸»é¢˜èµ„æºï¼Œä¿æŒä¸€è‡´æ€§

## ğŸ“Š æ•°æ®ç»‘å®š

### ViewModel

```csharp
public class ImageInfoViewModel : INotifyPropertyChanged
{
    public ImageInfo ImageInfo { get; }
    public string FileName => ImageInfo.FileName;
    public string Resolution => ImageInfo.Resolution;
    
    private BitmapImage? _thumbnail;
    public BitmapImage? Thumbnail
    {
        get => _thumbnail;
        set
        {
            _thumbnail = value;
            OnPropertyChanged(nameof(Thumbnail));
        }
    }
    
    // é€‰ä¸­çŠ¶æ€å±æ€§
    private bool _isSelected;
    public bool IsSelected
    {
        get => _isSelected;
        set
        {
            if (_isSelected != value)
            {
                _isSelected = value;
                OnPropertyChanged(nameof(IsSelected));
            }
        }
    }
}
```

### ç»‘å®šåˆ° UI

```csharp
// è®¾ç½®æ•°æ®æº
ImageListControl.ItemsSource = _imageInfos;

// XAML ä¸­ç»‘å®š
<TextBlock Text="{Binding FileName}"/>
<Image Source="{Binding Thumbnail}"/>
```

## ğŸ¨ æ ·å¼å’Œä¸»é¢˜

### ä½¿ç”¨ä¸»é¢˜èµ„æº

```xml
<TextBlock 
    Style="{ThemeResource BodyTextBlockStyle}"
    Foreground="{ThemeResource SystemControlForegroundBaseHighBrush}"/>
```

**è¯´æ˜**:
- è‡ªåŠ¨é€‚é…æ·±è‰²/æµ…è‰²ä¸»é¢˜
- ä¿æŒè§†è§‰ä¸€è‡´æ€§

### è‡ªå®šä¹‰æ ·å¼

```xml
<Border 
    Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
    BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
    BorderThickness="1"
    CornerRadius="8"
    Padding="16"/>
```

## ğŸ“š ä¸‹ä¸€æ­¥

- å­¦ä¹ å›¾ç‰‡å¤„ç† â†’ [12-å›¾ç‰‡å¤„ç†](./12-å›¾ç‰‡å¤„ç†.md)
- äº†è§£ EXIF è¯»å– â†’ [13-EXIFè¯»å–](./13-EXIFè¯»å–.md)

---

**ç»§ç»­å­¦ä¹ **: [12-å›¾ç‰‡å¤„ç†](./12-å›¾ç‰‡å¤„ç†.md) â†’

