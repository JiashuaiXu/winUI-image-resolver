# 06. è®¾è®¡æ¨¡å¼

äº†è§£é¡¹ç›®ä¸­ä½¿ç”¨çš„è®¾è®¡æ¨¡å¼å’Œæœ€ä½³å®è·µã€‚

## ğŸ¯ MVVM æ¨¡å¼

### ä»€ä¹ˆæ˜¯ MVVMï¼Ÿ

MVVM (Model-View-ViewModel) æ˜¯ WinUI 3 æ¨èçš„è®¾è®¡æ¨¡å¼ã€‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   View   â”‚ â†â”€â”€â†’ â”‚  ViewModel   â”‚ â†â”€â”€â†’ â”‚  Model   â”‚
â”‚  (XAML)  â”‚      â”‚   (C# é€»è¾‘)   â”‚      â”‚  (æ•°æ®)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### é¡¹ç›®ä¸­çš„å®ç°

**Model (æ¨¡å‹)**:
```csharp
// Models/ImageInfo.cs
public class ImageInfo
{
    public string FileName { get; set; }
    public int Width { get; set; }
    // ...
}
```

**View (è§†å›¾)**:
```xml
<!-- MainWindow.xaml -->
<TextBlock Text="{Binding FileName}"/>
```

**ViewModel (è§†å›¾æ¨¡å‹)**:
```csharp
// MainWindow.xaml.cs
public class ImageInfoViewModel : INotifyPropertyChanged
{
    public ImageInfo ImageInfo { get; }
    public string FileName => ImageInfo.FileName;
}
```

## ğŸ”§ æœåŠ¡æ¨¡å¼

### èŒè´£åˆ†ç¦»

**ImageInfoService**: åªè´Ÿè´£å›¾ç‰‡å¤„ç†
```csharp
public class ImageInfoService
{
    public async Task<List<ImageInfo>> ProcessImagesAsync(string folderPath)
    {
        // åªå¤„ç†å›¾ç‰‡ï¼Œä¸æ¶‰åŠ UI
    }
}
```

**CsvExportService**: åªè´Ÿè´£ CSV å¯¼å‡º
```csharp
public class CsvExportService
{
    public async Task<string> ExportToCsvAsync(List<ImageInfo> images, string outputPath)
    {
        // åªå¤„ç†å¯¼å‡ºï¼Œä¸æ¶‰åŠ UI
    }
}
```

## ğŸ“¦ ä¾èµ–æ³¨å…¥ï¼ˆç®€å•å®ç°ï¼‰

### åœ¨æ„é€ å‡½æ•°ä¸­æ³¨å…¥

```csharp
public sealed partial class MainWindow : Window
{
    private readonly ImageInfoService _imageInfoService;
    private readonly CsvExportService _csvExportService;
    
    public MainWindow()
    {
        // åˆ›å»ºæœåŠ¡å®ä¾‹
        _imageInfoService = new ImageInfoService();
        _csvExportService = new CsvExportService();
    }
}
```

**ä¼˜åŠ¿**:
- æœåŠ¡å¯æ›¿æ¢
- ä¾¿äºæµ‹è¯•
- èŒè´£æ¸…æ™°

## ğŸ¨ è§‚å¯Ÿè€…æ¨¡å¼

### INotifyPropertyChanged

```csharp
public class ImageInfoViewModel : INotifyPropertyChanged
{
    private BitmapImage? _thumbnail;
    
    public BitmapImage? Thumbnail
    {
        get => _thumbnail;
        set
        {
            _thumbnail = value;
            OnPropertyChanged(nameof(Thumbnail)); // é€šçŸ¥ UI æ›´æ–°
        }
    }
    
    public event PropertyChangedEventHandler? PropertyChanged;
    
    private void OnPropertyChanged(string propertyName)
    {
        PropertyChanged?.Invoke(this, new PropertyChangedEventArgs(propertyName));
    }
}
```

**è¯´æ˜**:
- UI è‡ªåŠ¨å“åº”æ•°æ®å˜åŒ–
- å®ç°æ•°æ®ç»‘å®š

## ğŸ”„ å¼‚æ­¥æ¨¡å¼

### Task-based Asynchronous Pattern (TAP)

```csharp
public async Task<List<ImageInfo>> ProcessImagesAsync(string folderPath)
{
    // è¿”å› Task<T>ï¼Œæ”¯æŒ await
}
```

**ç‰¹ç‚¹**:
- ç»Ÿä¸€çš„å¼‚æ­¥æ¨¡å¼
- æ˜“äºç»„åˆå’Œé”™è¯¯å¤„ç†

## ğŸ“š ä¸‹ä¸€æ­¥

- å­¦ä¹  WinUI 3 â†’ [07-WinUI3åŸºç¡€](./07-WinUI3åŸºç¡€.md)
- æŸ¥çœ‹ä»£ç å®ç° â†’ [11-UIå®ç°è¯¦è§£](./11-UIå®ç°è¯¦è§£.md)

---

**ç»§ç»­å­¦ä¹ **: [07-WinUI3åŸºç¡€](./07-WinUI3åŸºç¡€.md) â†’

