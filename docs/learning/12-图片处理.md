# 12. å›¾ç‰‡å¤„ç†

äº†è§£å¦‚ä½•è¯»å–å’Œå¤„ç†å›¾ç‰‡æ–‡ä»¶ã€‚

## ğŸ¯ å›¾ç‰‡å¤„ç†æµç¨‹

```
é€‰æ‹©æ–‡ä»¶å¤¹
    â†“
æ‰«æå›¾ç‰‡æ–‡ä»¶
    â†“
è¯»å–æ¯å¼ å›¾ç‰‡
    â”œâ”€ è·å–å›¾ç‰‡å°ºå¯¸
    â”œâ”€ è¯»å–æ–‡ä»¶ä¿¡æ¯
    â””â”€ æå– EXIF æ•°æ®
    â†“
åˆ›å»º ImageInfo å¯¹è±¡
    â†“
è¿”å›ç»“æœåˆ—è¡¨
```

## ğŸ“¦ Windows.Graphics.Imaging

### è¯»å–å›¾ç‰‡å°ºå¯¸

```csharp
using Windows.Graphics.Imaging;
using Windows.Storage;
using Windows.Storage.Streams;

private async Task<(int width, int height)> GetImageDimensionsAsync(StorageFile file)
{
    using (var stream = await file.OpenReadAsync())
    {
        var decoder = await BitmapDecoder.CreateAsync(stream);
        return ((int)decoder.PixelWidth, (int)decoder.PixelHeight);
    }
}
```

**è¯´æ˜**:
- `OpenReadAsync()`: å¼‚æ­¥æ‰“å¼€æ–‡ä»¶æµ
- `BitmapDecoder`: å›¾ç‰‡è§£ç å™¨
- `PixelWidth/PixelHeight`: è·å–å°ºå¯¸

### å®Œæ•´å®ç°

```csharp
private async Task<ImageInfo> ProcessImageAsync(StorageFile file)
{
    var imageInfo = new ImageInfo
    {
        FileName = file.Name,
        FilePath = file.Path
    };
    
    // è·å–æ–‡ä»¶å¤§å°
    var properties = await file.GetBasicPropertiesAsync();
    imageInfo.FileSize = (long)properties.Size;
    imageInfo.FileSizeFormatted = FormatFileSize(imageInfo.FileSize);
    
    // è·å–å›¾ç‰‡å°ºå¯¸
    using (var stream = await file.OpenReadAsync())
    {
        var decoder = await BitmapDecoder.CreateAsync(stream);
        imageInfo.Width = (int)decoder.PixelWidth;
        imageInfo.Height = (int)decoder.PixelHeight;
    }
    
    return imageInfo;
}
```

## ğŸ–¼ï¸ æ”¯æŒçš„å›¾ç‰‡æ ¼å¼

```csharp
var supportedExtensions = new[] 
{ 
    ".jpg", ".jpeg", ".png", ".bmp", ".tiff", ".tif", ".gif" 
};
```

**è¯´æ˜**:
- ä½¿ç”¨ `FileType` å±æ€§è¿‡æ»¤
- åªå¤„ç†æ”¯æŒçš„æ ¼å¼

## ğŸ“ æ–‡ä»¶æ‰«æ

### è·å–æ–‡ä»¶å¤¹ä¸­çš„æ–‡ä»¶

```csharp
var folder = await StorageFolder.GetFolderFromPathAsync(folderPath);
var files = await folder.GetFilesAsync();

foreach (var file in files.Where(f => supportedExtensions.Contains(f.FileType.ToLower())))
{
    var imageInfo = await ProcessImageAsync(file);
    imageInfos.Add(imageInfo);
}
```

## ğŸ”„ å¼‚æ­¥æ‰¹é‡å¤„ç†

### é¡ºåºå¤„ç†

```csharp
foreach (var file in files)
{
    var imageInfo = await ProcessImageAsync(file);
    imageInfos.Add(imageInfo);
}
```

**ç‰¹ç‚¹**:
- ä¸€å¼ ä¸€å¼ å¤„ç†
- ç®€å•ä½†è¾ƒæ…¢

### å¹¶å‘å¤„ç†ï¼ˆå¯é€‰ä¼˜åŒ–ï¼‰

```csharp
var tasks = files.Select(file => ProcessImageAsync(file));
var results = await Task.WhenAll(tasks);
imageInfos.AddRange(results);
```

**ç‰¹ç‚¹**:
- åŒæ—¶å¤„ç†å¤šå¼ å›¾ç‰‡
- æ›´å¿«ä½†å ç”¨æ›´å¤šèµ„æº

## âš ï¸ é”™è¯¯å¤„ç†

### å•ä¸ªæ–‡ä»¶é”™è¯¯

```csharp
foreach (var file in files)
{
    try
    {
        var imageInfo = await ProcessImageAsync(file);
        imageInfos.Add(imageInfo);
    }
    catch (Exception ex)
    {
        // è®°å½•é”™è¯¯ä½†ç»§ç»­å¤„ç†å…¶ä»–æ–‡ä»¶
        System.Diagnostics.Debug.WriteLine($"Error processing {file.Name}: {ex.Message}");
    }
}
```

**è¯´æ˜**:
- å•ä¸ªæ–‡ä»¶é”™è¯¯ä¸å½±å“æ•´ä½“
- è®°å½•é”™è¯¯æ—¥å¿—
- ç»§ç»­å¤„ç†å…¶ä»–æ–‡ä»¶

## ğŸ¨ ç¼©ç•¥å›¾ç”Ÿæˆ

### åŠ è½½ç¼©ç•¥å›¾

```csharp
private async Task LoadThumbnailsAsync()
{
    foreach (var viewModel in _imageInfos)
    {
        try
        {
            var file = await StorageFile.GetFileFromPathAsync(viewModel.ImageInfo.FilePath);
            var bitmap = new BitmapImage();
            await bitmap.SetSourceAsync(await file.OpenReadAsync());
            viewModel.Thumbnail = bitmap;
        }
        catch
        {
            // å¿½ç•¥ç¼©ç•¥å›¾åŠ è½½é”™è¯¯
        }
    }
}
```

**è¯´æ˜**:
- å¼‚æ­¥åŠ è½½ï¼Œä¸é˜»å¡ UI
- é”™è¯¯é™é»˜å¤„ç†
- ä½¿ç”¨ `BitmapImage` æ˜¾ç¤º

## ğŸ“Š æ–‡ä»¶å¤§å°æ ¼å¼åŒ–

```csharp
private string FormatFileSize(long bytes)
{
    string[] sizes = { "B", "KB", "MB", "GB" };
    double len = bytes;
    int order = 0;
    
    while (len >= 1024 && order < sizes.Length - 1)
    {
        order++;
        len = len / 1024;
    }
    
    return $"{len:0.##} {sizes[order]}";
}
```

**ç¤ºä¾‹**:
- 1024 bytes â†’ "1 KB"
- 1048576 bytes â†’ "1 MB"

## ğŸ“š ä¸‹ä¸€æ­¥

- å­¦ä¹  EXIF è¯»å– â†’ [13-EXIFè¯»å–](./13-EXIFè¯»å–.md)
- æŸ¥çœ‹å®Œæ•´å®ç° â†’ [15-æ ¸å¿ƒç±»è§£æ](./15-æ ¸å¿ƒç±»è§£æ.md)

---

**ç»§ç»­å­¦ä¹ **: [13-EXIFè¯»å–](./13-EXIFè¯»å–.md) â†’

